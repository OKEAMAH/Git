This directory contains [kaitai-struct](https://kaitai.io/) for the different
encodings used on the Tezos blockchain.

## Usage

You need to install `kaitai-struct-compiler`. Follow
[the upstream instructions](https://kaitai.io/#download).

```
kaitai-struct-compiler <some-file>.ksy -t <your-language-of-choice>
```

## Files

The files are automatically generated by `octez-codec`.

```
dune exec -- ../bin_codec_kaitai/codec.exe dump kaitai specs in ./
```

## Testing for correctness 

The files can be tested for syntactic correctness by running `make` target
which essentially runs:
```
kaitai-struct-compiler -t html $< --outdir=doc/
```
As can be seen from the command, generating HTML files forces `.ksy` files
to be parsed and thus checks them for corect syntax.

In addition we have `kaitai_e2e.sh` that does semantic testing of `.ksy` files.
In short the idea is that for a given `.ksy` we first generate a parser in
Javascript. After the parser is generated we assert that it can successfully
parse a set of valid input files and fails parsing a set of invalid input files.
