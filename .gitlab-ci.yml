---

include:
  - .gitlab/ci/sanity.yml
  - .gitlab/ci/build.yml
  - .gitlab/ci/unittest.yml
  - .gitlab/ci/integration.yml
  - .gitlab/ci/coq.yml
  - .gitlab/ci/tezt.yml
  - .gitlab/ci/doc.yml
  - .gitlab/ci/opam.yml
  - .gitlab/ci/publish.yml
  - .gitlab/ci/coverage.yml

variables:
  ## Please update `scripts/version.sh` accordingly
  build_deps_image_version: ddcc631c7a7b72c48c8bc7a11047bf0c18ef300e
  build_deps_image_name: registry.gitlab.com/nomadic-labs/opam-repository
  public_docker_image_name: docker.io/${CI_PROJECT_PATH}
  GIT_STRATEGY: fetch
  GIT_DEPTH: "1"
  GET_SOURCES_ATTEMPTS: "2"
  ARTIFACT_DOWNLOAD_ATTEMPTS: "2"

stages:
  - sanity
  - build
  - test
  - doc
  - packaging
  - publish
  - publish_manifest
  - test_coverage
  - publish_coverage

# we specify this template here that is used in all other
# targets in the include files. Include files cannot refer
# to variables defined here.
.runtime_build_test_dependencies_template:
  image: ${build_deps_image_name}:runtime-build-test-dependencies--${build_deps_image_version}
