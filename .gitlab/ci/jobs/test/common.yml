.template__code_quality:
  variables:
    CODE_QUALITY_REPORT: "_reports/gl-code-quality-report.json"

.test_template:
  extends:
    - .default_settings_template
    - .image_template__runtime_build_dependencies
    - .template__coverage
  needs:
    - "build_x86_64-released"
    - "build_x86_64-exp-dev-extra"
  stage: test
  before_script:
    - . ./scripts/version.sh
  retry: 2

# Merge coverage files after the execution
.template__coverage_files:
  extends: .template__coverage
  artifacts:
    name: "coverage-files-$CI_JOB_ID"
    paths:
      - $BISECT_FILE
    expire_in: 1 day
    when: on_success

.unit_test_template:
  extends: .test_template
  variables:
    ARCH: ""
    MAKE_TARGETS: ""
  script:
    - make $MAKE_TARGETS
  artifacts:
    name: "$CI_JOB_NAME-$CI_COMMIT_SHA-${ARCH}"
    paths:
      - test_results
    reports:
      junit: test_results/*.xml
    expire_in: 1 day
    when: always

.unit_test_template_x86_64:
  extends: .unit_test_template
  variables:
    ARCH: "x86_64"
