# This file was automatically generated, do not edit.
# Edit file ci/bin/main.ml instead.

oc.unified_coverage:
  image: ${build_deps_image_name}:runtime-e2etest-dependencies--${build_deps_image_version}
  stage: test_coverage
  tags:
  - gcp
  rules:
  - if: $GITLAB_USER_LOGIN == "nomadic-margebot"
    when: never
  - changes:
    - src/**/*
    - etherlink/**/*
    - tezt/**/*
    - .gitlab/**/*
    - .gitlab-ci.yml
    - michelson_test_scripts/**/*
    - tzt_reference_test_suite/**/*
    when: on_success
  needs:
  - oc.unit:non-proto-x86_64
  - oc.unit:other-x86_64
  - oc.unit:proto-x86_64
  - tezt 1/60
  - tezt 2/60
  - tezt 3/60
  - tezt 4/60
  - tezt 5/60
  - tezt 6/60
  - tezt 7/60
  - tezt 8/60
  - tezt 9/60
  - tezt 10/60
  - tezt 11/60
  - tezt 12/60
  - tezt 13/60
  - tezt 14/60
  - tezt 15/60
  - tezt 16/60
  - tezt 17/60
  - tezt 18/60
  - tezt 19/60
  - tezt 20/60
  - tezt 21/60
  - tezt 22/60
  - tezt 23/60
  - tezt 24/60
  - tezt 25/60
  - tezt 26/60
  - tezt 27/60
  - tezt 28/60
  - tezt 29/60
  - tezt 30/60
  - tezt 31/60
  - tezt 32/60
  - tezt 33/60
  - tezt 34/60
  - tezt 35/60
  - tezt 36/60
  - tezt 37/60
  - tezt 38/60
  - tezt 39/60
  - tezt 40/60
  - tezt 41/60
  - tezt 42/60
  - tezt 43/60
  - tezt 44/60
  - tezt 45/60
  - tezt 46/60
  - tezt 47/60
  - tezt 48/60
  - tezt 49/60
  - tezt 50/60
  - tezt 51/60
  - tezt 52/60
  - tezt 53/60
  - tezt 54/60
  - tezt 55/60
  - tezt 56/60
  - tezt 57/60
  - tezt 58/60
  - tezt 59/60
  - tezt 60/60
  - tezt-memory-4k 1/4
  - tezt-memory-4k 2/4
  - tezt-memory-4k 3/4
  - tezt-memory-4k 4/4
  - tezt-memory-3k 1/1
  - tezt-time-sensitive 1/1
  dependencies:
  - oc.unit:non-proto-x86_64
  - oc.unit:other-x86_64
  - oc.unit:proto-x86_64
  - tezt 1/60
  - tezt 2/60
  - tezt 3/60
  - tezt 4/60
  - tezt 5/60
  - tezt 6/60
  - tezt 7/60
  - tezt 8/60
  - tezt 9/60
  - tezt 10/60
  - tezt 11/60
  - tezt 12/60
  - tezt 13/60
  - tezt 14/60
  - tezt 15/60
  - tezt 16/60
  - tezt 17/60
  - tezt 18/60
  - tezt 19/60
  - tezt 20/60
  - tezt 21/60
  - tezt 22/60
  - tezt 23/60
  - tezt 24/60
  - tezt 25/60
  - tezt 26/60
  - tezt 27/60
  - tezt 28/60
  - tezt 29/60
  - tezt 30/60
  - tezt 31/60
  - tezt 32/60
  - tezt 33/60
  - tezt 34/60
  - tezt 35/60
  - tezt 36/60
  - tezt 37/60
  - tezt 38/60
  - tezt 39/60
  - tezt 40/60
  - tezt 41/60
  - tezt 42/60
  - tezt 43/60
  - tezt 44/60
  - tezt 45/60
  - tezt 46/60
  - tezt 47/60
  - tezt 48/60
  - tezt 49/60
  - tezt 50/60
  - tezt 51/60
  - tezt 52/60
  - tezt 53/60
  - tezt 54/60
  - tezt 55/60
  - tezt 56/60
  - tezt 57/60
  - tezt 58/60
  - tezt 59/60
  - tezt 60/60
  - tezt-memory-4k 1/4
  - tezt-memory-4k 2/4
  - tezt-memory-4k 3/4
  - tezt-memory-4k 4/4
  - tezt-memory-3k 1/1
  - tezt-time-sensitive 1/1
  allow_failure:
    exit_codes: 64
  script:
  - ./scripts/ci/report_coverage.sh || exit $?
  variables:
    TEZOS_WITHOUT_OPAM: "true"
    BISECT_FILE: $CI_PROJECT_DIR/_coverage_output/
    SLACK_COVERAGE_CHANNEL: C02PHBE7W73
  artifacts:
    expire_in: 15 days
    paths:
    - _coverage_report/
    - $BISECT_FILE
    reports:
      coverage_report:
        coverage_format: cobertura
        path: _coverage_report/cobertura.xml
    when: always
    expose_as: Coverage report
  coverage: '/Coverage: ([^%]+%)/'
