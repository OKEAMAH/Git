.bin_packages_common:
   extends:
    - .default_settings_template
   variables:
     TARGET: ""
     OCTEZ_PKGMAINTAINER: "nomadic-labs"
     BLST_PORTABLE: "yes"
     ARCH: "amd64"
   script:
    - . ./scripts/version.sh
    - wget https://sh.rustup.rs/rustup-init.sh
    - chmod +x rustup-init.sh
    - ./rustup-init.sh --profile minimal --default-toolchain  $recommended_rust_version -y
    - . $HOME/.cargo/env
    - export OPAMYES="true"
    - opam init --bare --disable-sandboxing
    - make build-deps
    - eval $(opam env)
    - make $TARGET
   artifacts:
    name: "${TARGET}-$ARCH-$CI_COMMIT_REF_SLUG"
    expire_in: 1 day
    when: on_success
