# This file was automatically generated, do not edit.
# Edit file ci/bin/main.ml instead.

oc.build_x86_64-released:
  image: ${build_deps_image_name}:runtime-build-dependencies--${build_deps_image_version}
  stage: build
  tags:
  - gcp
  rules:
  - changes:
    - src/**/*
    - etherlink/**/*
    - tezt/**/*
    - .gitlab/**/*
    - .gitlab-ci.yml
    - michelson_test_scripts/**/*
    - tzt_reference_test_suite/**/*
    when: on_success
  - if: $GITLAB_USER_LOGIN == "nomadic-margebot"
    when: on_success
  needs:
  - trigger
  dependencies: []
  before_script:
  - ./scripts/ci/take_ownership.sh
  - . ./scripts/version.sh
  - eval $(opam env)
  script:
  - ./scripts/ci/build_full_unreleased.sh
  variables:
    ARCH: x86_64
    EXECUTABLE_FILES: script-inputs/released-executables
    GIT_SHORTREF: "00000000"
    GIT_DATETIME: 1970-01-01 00:00:00 +0000%
    GIT_VERSION: dev
    COVERAGE_OPTIONS: --instrument-with bisect_ppx
    BISECT_FILE: $CI_PROJECT_DIR/_coverage_output/
    SLACK_COVERAGE_CHANNEL: C02PHBE7W73
  artifacts:
    name: build-$ARCH-$CI_COMMIT_REF_SLUG
    expire_in: 1 day
    paths:
    - octez-*
    - src/proto_*/parameters/*.json
    - _build/default/src/lib_protocol_compiler/bin/main_native.exe
    - _build/default/tezt/tests/main.exe
    - _build/default/contrib/octez_injector_server/octez_injector_server.exe
    when: on_success
